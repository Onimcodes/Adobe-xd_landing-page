(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4621],{30137:function(e,n,t){"use strict";t.d(n,{b:function(){return E},t:function(){return ie}});var r=t(67294),o=t(12398),a=t(93101),u=t(69429),i=t(298),c=t(65455),l=t(49313),s=t(34937),f=(0,s.defineContents)("externalworkflowpage",{headerDefault:{id:"headerDefault",type:"string",placeholderContent:"If you've made your purchase, get started now. (PH)"},messageDefault:{id:"messageDefault",type:"string",placeholderContent:"Please complete the purchase in your web browser. If you would like to purchase later, you can cancel now. (PH)"},cancelButtonDefault:{id:"cancelButtonDefault",type:"string",placeholderContent:"Cancel (PH)"},continueButtonDefault:{id:"continueButtonDefault",type:"string",placeholderContent:"Get Started (PH)"},headerChangePlan:{id:"headerChangePlan",type:"string",placeholderContent:"Switch your plan in your Adobe Account. (PH)"},messageChangePlan:{id:"messageChangePlan",type:"string",placeholderContent:"Once you are done, come back here and click Continue to proceed. If you would like to continue later, you can cancel for now. (PH)"},cancelButtonChangePlan:{id:"cancelButtonChangePlan",type:"string",placeholderContent:"Cancel (PH)"},continueButtonChangePlan:{id:"continueButtonChangePlan",type:"string",placeholderContent:"Continue (PH)"}}),d=t(8703),p=t(66537),v=t(52253),g=t(11051),m=t(12510),h=t(52007),O=t(3971),C=t(2037),y=r.createElement,E=(0,O.withAEMContent)("checkout/external",f.__contentType,f)((function(e){var n=e.workflow,t=(0,s.useContentEntry)(f),O=(0,g.useCommerceAppContext)().emitMessage,E=(0,h.useTrackEvent)();(0,r.useEffect)((function(){var e=(0,i.W6)("".concat(n).concat(v.ps.COMPLETE_PURCHASE_WEB,":").concat(v.ps.MODAL),"".concat(v.ps.COMPLETE_PURCHASE_WEB));E(e)}),[E,n]);var P=function(e){switch(e){case d.q.CHANGE_PLAN:return{header:t.get(f.headerChangePlan),message:t.get(f.messageChangePlan),cancelButton:t.get(f.cancelButtonChangePlan),continueButton:t.get(f.continueButtonChangePlan)};default:return{header:t.get(f.headerDefault),message:t.get(f.messageDefault),cancelButton:t.get(f.cancelButtonDefault),continueButton:t.get(f.continueButtonDefault)}}}(n),b=P.header,_=P.message,T=P.cancelButton,S=P.continueButton,I=(0,m.useStore)(),A=(0,c.jz)(I.getState());return y("div",{className:u.Z.container},!A&&y("div",{className:u.Z.closeContainer},y(o.default,{variant:"action",quiet:!0,onClick:function(){O(g.SystemMessage.CLOSE)},icon:y(a.default,{size:"L"}),"data-testid":"closeButton"})),y("div",{className:u.Z.center},y(p.InfoLight,{size:"L","data-testid":"externalWorkflowIcon"}),y(l.X6,null,b),y("p",{className:u.Z.message},_),y("div",{className:u.Z.buttonContainer},y(o.default,{variant:"secondary","data-testid":"externalWorkflowCancelButton",onClick:function(){var e=(0,i.W6)("".concat(n).concat(v.ps.COMPLETE_PURCHASE_WEB,":").concat(v.ps.CANCEL),"".concat(v.ps.COMPLETE_PURCHASE_WEB).concat(v.ps.CANCEL));E(e),O(g.SystemMessage.CLOSE)}},T),y(o.default,{variant:"cta","data-testid":"externalWorkflowContinueButton",onClick:function(){var e=(0,i.W6)("".concat(n).concat(v.ps.COMPLETE_PURCHASE_WEB,":").concat(v.ps.GET_STARTED),"".concat(v.ps.COMPLETE_PURCHASE_WEB).concat(v.ps.GET_STARTED));E(e),O(g.SystemMessage.CLOSE,{status:C.WorkflowStatus.ORDER_COMPLETE})}},S))))})),P=t(46829),b=t(55077),_=t(27261),T=t(71439);function S(){var e=(0,_.Z)(["\n  query UserSubscriptionChangePlanQuery($offerId: ID!, $subscriptionId: ID!) {\n    user {\n      id\n      userSubscription(subscriptionId: $subscriptionId) {\n        id\n        changePlanAllowed(offerId: $offerId)\n      }\n    }\n  }\n"]);return S=function(){return e},e}function I(){var e=(0,_.Z)(["\n  fragment IneligiblePurchaseOrderFragment on Order {\n    marketSegment\n    country\n    cart {\n      cartItems {\n        offerId\n        conflicts {\n          offerId\n          reasonCode\n          subscriptionId\n        }\n      }\n    }\n  }\n"]);return I=function(){return e},e}function A(){var e=(0,_.Z)(["\n  query getOfferForIneligiblePurchaseQuery($offerId: ID!, $country: String!) {\n    offer(id: $offerId, country: $country) {\n      ...IneligiblePurchaseOfferFragment\n    }\n  }\n  ","\n"]);return A=function(){return e},e}function w(){var e=(0,_.Z)(["\n  fragment IneligiblePurchaseOfferFragment on Offer {\n    id\n    commitment\n    term\n    productArrangement {\n      cloud\n    }\n    offerContent {\n      productName\n      productIconUrls\n    }\n  }\n"]);return w=function(){return e},e}var R=(0,T.gql)(w()),k=(0,T.gql)(A(),R),D=(0,T.gql)(I()),U=(0,T.gql)(S()),N=function(e,n,t){return e.query({query:k,variables:{offerId:n,country:t}}).then((function(e){return e.data.offer}))},Z=t(62482),j=t(36623),L=t(26265),x=t(809),M=t.n(x),F=t(92447),B=t(38347),H=t(91229),q=t(85564),G=t.n(q),W=t(37244),$=t.n(W),z=t(99246),V=t(61792),Y=t(73728),K=t(4190),X=t(62452),Q=t(85686),J=r.createElement,ee=function(e){return J(P.ApolloConsumer,null,(function(n){return J(ne,(0,H.Z)({client:n},e))}))},ne=function(e){var n=e.client,t=e.openUrl,o=e.onFooterClicked,a=(0,B.Z)(e,["client","openUrl","onFooterClicked"]),u=(0,Q.useLogger)(),i=(0,r.useContext)(m.StoreContext).getState(),l=(0,c.n$)(i),s=(0,m.useSelector)(j.NO),f=(0,V.hP)(i),d=(0,V.et)(i),p=null===d||void 0===d?void 0:d.userId,v=(0,K.useFeatureFlags)(z.R.UC_I2T_PES)[z.R.UC_I2T_PES],g=(0,X.tD)(),h=g.redirect,O=g.cancelUrl,C=null!==t&&void 0!==t?t:h,y=(0,X.Sd)(),E=n.readFragment({fragment:D,id:"Order:".concat(s),fragmentName:"IneligiblePurchaseOrderFragment"}),P=(0,r.useCallback)(function(){var e=(0,F.Z)(M().mark((function e(t,r){return M().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N(n,t,r);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}(),[n]),_=(0,r.useCallback)((function(e,t){return function(e,n,t,r){return e.query({query:U,variables:{offerId:n,subscriptionId:t},context:r,fetchPolicy:"network-only"}).then((function(e){var n=(e.data.user||{}).userSubscription;return null===n||void 0===n?void 0:n.changePlanAllowed})).catch((function(){return!1}))}(n,e,t,f?{headers:{authorization:f}}:{})}),[n,f]),T=(0,r.useCallback)(function(){var e=(0,F.Z)(M().mark((function e(t){var r,o;return M().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,b.getIndividualToTeamUpgradeOffers)(n,t,p,l);case 2:return r=e.sent,o=r.data,e.abrupt("return",{data:o});case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),[n,l,p]),S=(0,r.useCallback)(function(){var e=(0,F.Z)(M().mark((function e(n){var t,r,o,a,i,c;return M().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u.info("Checking whether user is eligible for I2T upgrade in case of duplicate purchase"),v){e.next=3;break}return e.abrupt("return",!1);case 3:return e.next=5,T(n);case 5:if(i=e.sent,c=i.data,!((null===c||void 0===c||null===(t=c.individualToTeamUpgradeOffers)||void 0===t||null===(r=t.activeOffersResult)||void 0===r?void 0:r.filter((function(e){var n,t;return null===e||void 0===e||null===(n=e.offer)||void 0===n||null===(t=n.tags)||void 0===t?void 0:t.includes("ACTIVE_SUBSCRIPTION_I2T_UPGRADEABLE")}))).length>0&&(null===c||void 0===c||null===(o=c.individualToTeamUpgradeOffers)||void 0===o||null===(a=o.upgradeOffersResult)||void 0===a?void 0:a.offers.length)>0)){e.next=11;break}return u.info("Eligible for i2t upgrade as part of duplicate purchase from A.com"),e.abrupt("return",!0);case 11:return e.abrupt("return",!1);case 12:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),[T,v,u]),I=function(e,n,t){var r,o=null===e||void 0===e||null===(r=e.productArrangement)||void 0===r?void 0:r.family,a=t.find((function(e){return(null===e||void 0===e?void 0:e.paFamily)===o}));return n.includes(null===a||void 0===a?void 0:a.id)},A=(0,r.useCallback)(function(){var e=(0,F.Z)(M().mark((function e(n){var t,r,o,a,i,c,s,f,d,p,v,g,m,h,O,C,P;return M().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,T(n);case 2:d=e.sent,p=d.data,v=null===p||void 0===p||null===(t=p.individualToTeamUpgradeOffers)||void 0===t?void 0:t.activeSubscriptions,g=null===p||void 0===p||null===(r=p.individualToTeamUpgradeOffers)||void 0===r||null===(o=r.activeOffersResult)||void 0===o?void 0:o.map((function(e){return{id:null===e||void 0===e?void 0:e.offer.id,paFamily:null===e||void 0===e?void 0:e.offer.productArrangement.family}})),m=null===p||void 0===p||null===(a=p.individualToTeamUpgradeOffers)||void 0===a||null===(i=a.upgradeOffersResult)||void 0===i?void 0:i.offers,h=null===E||void 0===E||null===(c=E.cart)||void 0===c||null===(s=c.cartItems)||void 0===s?void 0:s.map((function(e){var n;return null===e||void 0===e||null===(n=e.conflicts)||void 0===n?void 0:n.map((function(e){return e.offerId}))})),O=G()(h),C=null===m||void 0===m?void 0:m.map((function(e,n){var t=e.offer;if(n<v.length)return{id:t.id,q:I(t,O,g)?2:1}})).filter((function(e){return void 0!==e})),f={},(0,L.Z)(f,$().app.COUNTRY.name,n),(0,L.Z)(f,$().app.LANGUAGE.name,l),(0,L.Z)(f,$().app.CURRENT_SUBSCRIPTION_IDS.name,v),(0,L.Z)(f,$().app.ITEMS.name,C),P=f,u.info("Redirecting to i2t payment page as part of duplicate purchase from A.com"),y(P);case 13:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),[T,y,l,E,u]),w=(0,K.useFeatureFlags)(z.R.UC_SWITCH_PLAN_URL_UPDATE)[z.R.UC_SWITCH_PLAN_URL_UPDATE],R=Y.j$.IN_WEB;return J(Y.jO,(0,H.Z)({fetchOffer:P,fetchUserSubscriptionChangeOfferAllowed:_,fetchIndividualToTeamUpgradeAllowed:S,upgradeIndividualToTeam:A,locale:l,switchPlanSurface:w?R:void 0,order:E,openUrl:C,onFooterClicked:o,cancelUrl:O},a))},te=t(56),re=t(276),oe=r.createElement;function ae(e,n){var t;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(t=function(e,n){if(!e)return;if("string"===typeof e)return ue(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return ue(e,n)}(e))||n&&e&&"number"===typeof e.length){t&&(e=t);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,u=!0,i=!1;return{s:function(){t=e[Symbol.iterator]()},n:function(){var e=t.next();return u=e.done,e},e:function(e){i=!0,a=e},f:function(){try{u||null==t.return||t.return()}finally{if(i)throw a}}}}function ue(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}var ie=function(e){var n=e.children,t=(0,P.useApolloClient)(),o=(0,te.TZ)(),a=(0,g.useCommerceAppContext)().isInApp,u=(0,X.nV)(),i=(0,r.useState)(!1),c=i[0],l=i[1],s=(0,r.useState)(void 0),f=s[0],p=s[1],v=(0,re.useSelector)(j.NO),m=(0,r.useCallback)((function(){var e,n,r=t.readFragment({fragment:D,id:"Order:".concat(v),fragmentName:"IneligiblePurchaseOrderFragment"}),o=ae(null===r||void 0===r||null===(e=r.cart)||void 0===e?void 0:e.cartItems);try{for(o.s();!(n=o.n()).done;){var a,u=ae(n.value.conflicts);try{for(u.s();!(a=u.n()).done;){var i=a.value;if(i.reasonCode)return i.reasonCode}}catch(c){u.e(c)}finally{u.f()}}}catch(c){o.e(c)}finally{o.f()}}),[v,t]);function h(e){switch(e){case b.CartItemConflictReason.IneligibleSwitch:case b.CartItemConflictReason.IneligibleIncluded:case b.CartItemConflictReason.IneligibleDuplicateUpgrade:p(d.q.CHANGE_PLAN);break;default:p(void 0)}}return oe(r.Fragment,null,oe(ee,{openUrl:a()?function(e){h(m()),l(!0);var n=(0,Z.AK)(e);u(n)}:void 0,onFooterClicked:a()?function(){h(void 0),l(!0)}:void 0,adobeLaunchAnalytics:o}),c?oe(E,{workflow:f}):n)}},82052:function(e,n,t){"use strict";t.d(n,{W:function(){return R},F:function(){return w}});var r=t(37244),o=t.n(r),a=t(99246),u=t(65455),i=t(96029),c=t(61792),l=t(57332),s=t(4190),f=t(14157),d=t(26265),p=t(46829),v=t(2385),g=t(9556),m=t(31549),h=t(11426),O=t(67294),C=t(55988),y=t(12510);function E(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function P(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?E(Object(t),!0).forEach((function(n){(0,d.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):E(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var b=t(27261),_=t(71439),T=t(36623),S=t(59180);function I(){var e=(0,b.Z)(["\n              fragment ProductArrangementCodeRepresentativeOffer on PersonalizedOffer {\n                offer {\n                  productArrangementCode\n                }\n              }\n            "]);return I=function(){return e},e}var A=t(276),w=function(){var e=(0,s.useFeatureFlags)(a.R.UC_M5)[a.R.UC_M5],n=(0,A.useStore)().getState(),t=(0,C.t)().currentRoute,r=(0,u.mT)(n),d=(0,i.vl)(n),E=e||(0,u.Nl)(n),b=R(r,d),w=(0,s.useFeatureFlags)([a.R.UC_SUPPORTED_PRODUCT_ARRANGEMENT_CODES,a.R.UC_SUPPORTED_OFFERS]),k=!!d[o().app.AFF_PROMO_NAME.name],D=(0,f.k)(),U=function(){var e=(0,p.useApolloClient)(),n=(0,y.useSelector)(u.ym),t=(0,y.useSelector)(i.vl)[o().app.PA_CODE.name],r=(0,y.useSelector)(T.M8),a=(0,C.t)().currentRoute;return(0,O.useMemo)((function(){if(t)return!!n.includes(t);var o=r.map((function(n){var t,r=e.readFragment({id:"PersonalizedOffer:".concat(a===l.Z.BUNDLE?S.xb.BUNDLES:S.xb.COMMITMENT_VARIANTS,":").concat(n),fragment:(0,_.gql)(I())});return null===r||void 0===r||null===(t=r.offer)||void 0===t?void 0:t.productArrangementCode}));return o.filter((function(e){return n.includes(e)})).length===o.length}),[])}(),N=function(){var e,n=(0,p.useApolloClient)(),t=(0,C.t)().currentRoute,r=(0,y.useSelector)(u.mT),f=(0,y.useSelector)(u.n$),d=null===(e=(0,y.useSelector)(c.et))||void 0===e?void 0:e.userId,E=(0,y.useSelector)(h.tT),b=(0,y.useSelector)(i.yq),_=(0,y.useSelector)(i.wT),T=(0,y.useSelector)(i.vl)[o().app.CLIENT_ID.name],S=(0,y.useSelector)(i.vl)[o().app.SVAR.name],I=(0,s.useFeatureFlags)(a.R.P_UC_USE_TEST_CAMPAIGNS),A=null===I||void 0===I?void 0:I[a.R.P_UC_USE_TEST_CAMPAIGNS];return(0,O.useMemo)((function(){var e;if(t===l.Z.SEGMENTATION)return!0;var o={country:r,locale:f,userId:d,clientId:T,svar:S,useTestCampaign:A};t===l.Z.COMMITMENT&&b&&_&&!b.includes(_)&&b.push(_);var a=t===l.Z.BUNDLE?(0,g.DA)(P(P({},o),{},{offerIds:E?[E]:b})):(0,m.q)(P(P({},o),{},{offerIds:b})),u=t===l.Z.BUNDLE?g.d7:m.l,i=n.readQuery({query:u,variables:a}),c=t===l.Z.BUNDLE?"bundleOffers":"commitmentVariantsOffers",s=null===i||void 0===i||null===(e=i[c])||void 0===e?void 0:e.result;return!(null===s||void 0===s?void 0:s.find((function(e){var n;return null===e||void 0===e||null===(n=e.offers)||void 0===n?void 0:n.find((function(e){var n,t,r,o;return(null===e||void 0===e||null===(n=e.offer)||void 0===n||null===(t=n.pricePoint)||void 0===t?void 0:t.includes("PROMO_AFFINITY"))||(null===e||void 0===e||null===(r=e.offer)||void 0===r?void 0:r.commitment)===v.y3.Perpetual||(null===e||void 0===e||null===(o=e.offer)||void 0===o?void 0:o.customerSegment)===v.op.Team}))})))}),[t])}();if([l.Z.DTM_IFRAME,l.Z.PAYPAL,l.Z.LEARN_MORE_DIALOG,l.Z.CONFIRMATION,l.Z.POST_SET_PASSWORD,l.Z.HEALTH,l.Z.PRELOAD,l.Z.LINK_GENERATOR,l.Z.DASHBOARD_IFRAME].includes(t))return!1;var Z=!E&&!b,j=(0,c.D7)(n),L=w[a.R.UC_SUPPORTED_PRODUCT_ARRANGEMENT_CODES]&&!U&&!D&&!w[a.R.UC_SUPPORTED_OFFERS],x=!N&&!D&&w[a.R.UC_SUPPORTED_OFFERS];return Z||j||L||x||k},R=function(e,n){return(null===n||void 0===n?void 0:n[o().app.EXTEND_COUNTRY_SUPPORT.name])&&(null===n||void 0===n?void 0:n[o().app.EXTEND_COUNTRY_SUPPORT.name])===e}},46576:function(e,n,t){"use strict";t.d(n,{mw:function(){return h},Vk:function(){return E}});var r=t(809),o=t.n(r),a=t(92447),u=t(27261),i=t(71439),c=t(46829),l=t(36623),s=t(61792),f=t(65455),d=t(62452),p=t(276),v=t(67294),g=t(12510);function m(){var e=(0,u.Z)(["\n  query GET_COUNTRY_CHANGE_ALLOWED {\n    user {\n      id\n      countryChangeAllowed\n    }\n  }\n"]);return m=function(){return e},e}var h="GET_COUNTRY_CHANGE_ALLOWED",O=(0,i.gql)(m());function C(e,n){return y.apply(this,arguments)}function y(){return(y=(0,a.Z)(o().mark((function e(n,t){var r,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=!1,e.prev=1,!t){e.next=7;break}return e.next=5,n.query({query:O,context:{headers:{Authorization:"Bearer ".concat(t)}},fetchPolicy:"no-cache"});case 5:a=e.sent,r=a.data.user.countryChangeAllowed;case 7:e.next=11;break;case 9:e.prev=9,e.t0=e.catch(1);case 11:return e.abrupt("return",r);case 12:case"end":return e.stop()}}),e,null,[[1,9]])})))).apply(this,arguments)}var E=function(){var e=(0,p.useDispatch)(),n=(0,d.KW)(),t=(0,g.useStore)().getState(),r=(0,s.PQ)(t),u=(0,f.mT)(t),i=(0,s.et)(t).countryCode,m=(0,s.hP)(t),h=(0,l.qr)(t),O=(0,c.useApolloClient)();(0,v.useEffect)((function(){function t(){return(t=(0,a.Z)(o().mark((function t(){var r,a;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=!0,a=i&&i!==u,t.t0=!h,!t.t0){t.next=7;break}return t.next=6,C(O,m);case 6:t.t0=t.sent;case 7:r=t.t0,a&&!r&&n(i),e((0,s.oY)(r));case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}r&&function(){t.apply(this,arguments)}()}),[])}},47130:function(e,n,t){"use strict";t.d(n,{Z:function(){return p},G:function(){return v}});var r=t(64679),o=t.n(r),a=t(8777),u=t.n(a),i=t(87835),c=t(19291),l=t(49675),s=t(34155),f={keepAlive:!0,timeout:l.L.SOCKET_TIMEOUT};s.env.APP_ENV===i.T.LOCAL&&(f.rejectUnauthorized=!1);var d=(0,c.Lf)()?void 0:new(u().Agent)(f);function p(){return d}function v(){return new(o().Agent)(f)}},75295:function(e,n,t){"use strict";t.d(n,{Y:function(){return p}});var r=t(809),o=t.n(r),a=t(92447),u=t(66309);function i(){return{expiry:Number.MAX_SAFE_INTEGER,tokenPromise:null}}var c=i();function l(e,n){return u.Z.getImsServiceToken(e,n)}function s(){return!c.tokenPromise||Date.now()>c.expiry}function f(e){return Date.now()+1e3*e.expires_in/1.2}function d(){c=i()}function p(){return v.apply(this,arguments)}function v(){return(v=(0,a.Z)(o().mark((function e(){var n,t,r,a,u=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=u.length>0&&void 0!==u[0]?u[0]:{},t=u.length>1?u[1]:void 0,e.prev=2,!s()){e.next=12;break}return c.expiry=Number.MAX_SAFE_INTEGER,c.tokenPromise=l(n,t),e.next=8,c.tokenPromise;case 8:r=e.sent,c.expiry=f(r),e.next=15;break;case 12:return e.next=14,c.tokenPromise;case 14:r=e.sent;case 15:a=r.access_token,e.next=21;break;case 18:e.prev=18,e.t0=e.catch(2),d();case 21:return e.abrupt("return",a);case 22:case"end":return e.stop()}}),e,null,[[2,18]])})))).apply(this,arguments)}},66309:function(e,n,t){"use strict";t.d(n,{Z:function(){return S}});var r=t(809),o=t.n(r),a=t(92447),u=t(26265),i=t(49675);function c(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}var l,s=(0,t(47130).Z)(),f=function(){var e=(0,a.Z)(o().mark((function e(n){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.clone().json();case 3:(t=e.sent)&&l.info({data:t,path:n.url,status:n.status}),e.next=9;break;case 7:e.prev=7,e.t0=e.catch(0);case 9:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(n){return e.apply(this,arguments)}}(),d={request:function(e,n){var t=function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?c(Object(t),!0).forEach((function(n){(0,u.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):c(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}({agent:s,compress:!0},n);return l=null===n||void 0===n?void 0:n.logger,[e,t]},response:function(e){if(+(null===e||void 0===e?void 0:e.status)>=300)throw l&&f(e),e;return e}},p=t(41681),v=t(97803),g=t(24817),m=t(34155);function h(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function O(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?h(Object(t),!0).forEach((function(n){(0,u.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):h(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function C(e){return(0,g.Z0)(e)?m.env.IMS_CLT_APP_SECRET:m.env.IMS_CLT_SECRET}function y(e){return O(O({},(0,p.ft)(e)),{},{secret:C(e)})}function E(){return{domain:(0,p.Fy)(),clientId:v.$.UNIFIED_CHECKOUT_SERVER,secret:m.env.IMS_SVR_SECRET,authCode:m.env.IMS_SVR_AUTH_CODE}}var P=t(10975),b=t(80129);function _(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function T(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?_(Object(t),!0).forEach((function(n){(0,u.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):_(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var S=function(){var e=(0,i.Z)(d),n=function(){var e=(0,a.Z)(o().mark((function e(n,r){var a,u,i,c=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=c.length>2&&void 0!==c[2]?c[2]:{},u=c.length>3?c[3]:void 0,(i=T({},y(r))).authCode=n,e.abrupt("return",t(i,a,u));case 5:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}(),t=function(){var n=(0,a.Z)(o().mark((function n(t){var r,a,u,i=arguments;return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=i.length>1&&void 0!==i[1]?i[1]:{},a=i.length>2?i[2]:void 0,u={grant_type:"authorization_code",code:t.authCode,client_id:t.clientId,client_secret:t.secret},n.next=5,e.post("".concat(t.domain,"/ims/token/v2?").concat((0,b.stringify)(u)),{headers:T({},r),logger:a});case 5:return n.abrupt("return",n.sent);case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();return T(T({},e),{},{getImsHealthCheck:function(n){var t=E();return e.get("".concat(t.domain,"/ims/healthcheck"),{headers:(0,u.Z)({},P.A.name.X_IMS_CLIENTID,t.clientId),timeout:i.L.IMS_HEALTH_CHECK_TIMEOUT,logger:n})},getImsProfileAndToken:function(n,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3?arguments[3]:void 0,a=y(t);return e.post("".concat(a.domain,"/ims/token/v3"),{body:(0,b.stringify)({grant_type:"aux_sid_exchange",client_id:a.clientId,client_secret:a.secret,aux_sid:n,scope:a.scopes,project_user_profile:!0}),headers:T({"Content-Type":"application/x-www-form-urlencoded"},r),timeout:i.L.SHORT_HTTP_TIMEOUT,logger:o})},getImsAccessToken:n,getImsProfileAndTokenFromImplicitJumpToken:function(n,t,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=arguments.length>4?arguments[4]:void 0,u=y(r),c={client_id:u.clientId};return e.get("".concat(u.domain,"/ims/jump/implicit/").concat(n,"?").concat((0,b.stringify)(c)),{headers:T({Authorization:"Bearer ".concat(t)},o),timeout:i.L.SHORT_HTTP_TIMEOUT,logger:a},{includeHeaders:!0})},getImsServiceToken:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0,r=E();return t(r,e,n)}})}()},64679:function(){},8777:function(){}}]);